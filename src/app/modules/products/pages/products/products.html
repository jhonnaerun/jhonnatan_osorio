<app-header />

<div class="container">

  <div class="card bg-base-100 shadow-md">
    <div class="card-body p-4">
      @if (products.isLoading()) {
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4">

        <div class="w-full sm:max-w-xs">
          <div class="skeleton h-10 w-full"></div>
        </div>

        <div class="skeleton h-10 w-40"></div>
      </div>

      <div class="overflow-x-auto">
        <table class="table w-full">
          <thead>
            <tr>
              <th>Logo</th>
              <th>Producto</th>
              <th>Descripción</th>
              <th>Fecha de liberación</th>
              <th>Fecha de reestructuración</th>
              <th class="text-center">Acciones</th>
            </tr>
          </thead>

          <tbody>
            @for (i of [1,2,3,4]; track i) {
            <tr>
              <td>
                <div class="skeleton w-10 h-10 rounded"></div>
              </td>

              <td>
                <div class="skeleton h-4 w-32"></div>
              </td>

              <td>
                <div class="skeleton h-4 w-48"></div>
              </td>

              <td>
                <div class="skeleton h-4 w-28"></div>
              </td>

              <td>
                <div class="skeleton h-4 w-28"></div>
              </td>

              <td>
                <div class="flex justify-center gap-4">
                  <div class="skeleton h-5 w-5"></div>
                  <div class="skeleton h-5 w-5"></div>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      } @else {
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4">

        <div class="w-full sm:max-w-xs">
          <label class="input input-bordered flex items-center gap-2">
            <ng-icon name="heroMagnifyingGlass" />
            <input type="text" class="grow" placeholder="Buscar producto..." />
          </label>
        </div>

        <button class="btn btn-warning" (click)="router.navigate(['/products/product'])">
          <ng-icon name="heroPlus" />
          Agregar producto
        </button>
      </div>

      <div class="overflow-x-auto">
        <table class="table table-zebra w-full">
          <thead>
            <tr>
              <th>Logo</th>
              <th>Producto</th>
              <th>Descripción</th>
              <th>Fecha de liberación</th>
              <th>Fecha de reestructuración</th>
              <th class="text-center">Acciones</th>
            </tr>
          </thead>

          <tbody>
            @for (p of products.data(); track $index) {
            <tr>
              <td>
                <div class="avatar">
                  <div class="w-10 rounded">
                    <img [src]="p.logo" />
                  </div>
                </div>
              </td>

              <td class="font-medium">
                {{p.name}}
              </td>

              <td class="max-w-xs truncate">
                {{p.description}}
              </td>

              <td>{{p.date_release}}</td>
              <td>{{p.date_revision}}</td>
              <td>
                <div class="flex justify-center gap-4">
                  <div class="cursor-pointer" (click)="router.navigate([`/products/product/${p.id}`])">
                    <ng-icon name="heroPencil" />
                  </div>
                  <div class="text-red-500 cursor-pointer" (click)="openDeleteModal(p)">
                    @if(deleteProduct.isPending() && p.id === selectedProduct?.id) {
                      <span class="loading loading-spinner loading-xs"></span>
                    } @else {
                      <ng-icon name="heroTrash" />
                    }
                  </div>
                </div>
              </td>
            </tr>
            } @empty {
              <div class="w-full mt-5 text-center">
                <h1 class="text-gray-500">No existen productos disponibles</h1>
              </div>
            }
          </tbody>
        </table>
      </div>

      }
    </div>
  </div>
</div>

<dialog #my_modal class="modal">
  <div class="modal-box">
    <p class="py-4">¿Estas seguro de eliminar el producto {{selectedProduct?.name}}?</p>
    <div class="modal-action">
      <form method="dialog" class="flex gap-4">
        <button class="btn btn-soft">Cancelar</button>
        <button class="btn btn-warning" (click)="nextDelete()">
          <ng-icon name="heroTrash" />
          Confirmar
        </button>
      </form>
    </div>
  </div>
</dialog>

<div class="toast toast-end hidden" #toastDelete>
  <div class="alert alert-success">
    <span>Producto eliminado.</span>
  </div>
</div>
